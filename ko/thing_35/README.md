# API 설계의 황금률

API 설계는 특히 대규모에서 어렵습니다. 수백 또는 수천 명의 사용자를 가질 API를 설계하고 있다면, 미래에 어떻게 변경할 수 있을지와 그 변경이 클라이언트 코드를 깨뜨릴 수 있는지에 대해 생각해야 합니다. 그 이상으로, API 사용자들이 당신에게 어떤 영향을 미치는지에 대해서도 생각해야 합니다. API 클래스 중 하나가 내부적으로 자체 메서드 중 하나를 사용한다면, 사용자가 당신의 클래스를 서브클래싱하고 그것을 오버라이드할 수 있다는 것을 기억해야 하며, 그것은 재앙적일 수 있습니다. 일부 사용자들이 그 메서드에 다른 의미를 부여했기 때문에 그 메서드를 변경할 수 없을 것입니다. 미래의 내부 구현 선택은 사용자들의 자비에 달려있습니다.

API 개발자들은 다양한 방법으로 이 문제를 해결하지만, 가장 쉬운 방법은 API를 잠그는 것입니다. Java로 작업하고 있다면 대부분의 클래스와 메서드를 final로 만들고 싶을 수도 있습니다. C#에서는 클래스와 메서드를 sealed로 만들 수도 있습니다. 사용하는 언어에 관계없이, 싱글톤을 통해 API를 제공하거나 정적 팩터리 메서드를 사용해서 행동을 오버라이드하고 나중에 당신의 선택을 제약할 수 있는 방식으로 코드를 사용할 수 있는 사람들로부터 보호하고 싶을 수도 있습니다. 이 모든 것이 합리적으로 보이지만, 정말 그럴까요?

지난 10년 동안, 우리는 단위 테스트가 실무의 극히 중요한 부분이라는 것을 점차 깨달았지만, 그 교훈이 업계에 완전히 스며들지는 않았습니다. 증거는 우리 주변 모든 곳에 있습니다. 서드파티 API를 사용하는 임의의 테스트되지 않은 클래스를 가져와서 그것을 위한 단위 테스트를 작성해보세요. 대부분의 경우, 문제에 부딪힐 것입니다. API를 사용하는 코드가 접착제처럼 달라붙어 있다는 것을 알게 될 것입니다. API 클래스들을 흉내내어 코드가 그들과 상호작용하는 것을 감지하거나, 테스트를 위한 반환값을 제공할 방법이 없습니다.

시간이 지나면서 이것은 나아질 것이지만, API를 설계할 때 테스트를 실제 사용 사례로 보기 시작할 때만 그럴 것입니다. 불행히도, 이것은 단순히 우리 코드를 테스트하는 것보다 조금 더 복잡합니다. 여기서 **API 설계의 황금률**이 들어맞습니다: *당신이 개발하는 API를 위한 테스트를 작성하는 것만으로는 충분하지 않습니다. 당신의 API를 사용하는 코드를 위한 단위 테스트를 작성해야 합니다. 그렇게 할 때, 사용자들이 독립적으로 코드를 테스트하려고 할 때 극복해야 할 장애물들을 직접 경험하게 됩니다.*

개발자들이 당신의 API를 사용하는 코드를 테스트하기 쉽게 만드는 단 하나의 방법은 없습니다. `static`, `final`, `sealed`는 본질적으로 나쁜 구조체가 아닙니다. 때때로 유용할 수 있습니다. 하지만 테스트 문제를 인식하는 것이 중요하며, 그렇게 하려면 스스로 경험해야 합니다. 일단 경험하고 나면, 다른 설계 도전과제에 접근하는 것처럼 그것에 접근할 수 있습니다.

[Michael Feathers](http://programmer.97things.oreilly.com/wiki/index.php/Michael_Feathers)가 작성함.